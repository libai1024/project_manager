<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾ç½® Token å¹¶æµ‹è¯• API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: monospace;
        }
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        button {
            background: #409eff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-top: 10px;
        }
        button:hover {
            background: #66b1ff;
        }
        button.success {
            background: #67c23a;
        }
        button.danger {
            background: #f56c6c;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
            font-size: 13px;
        }
        .success {
            background: #f0f9ff;
            border: 1px solid #67c23a;
            color: #333;
        }
        .error {
            background: #fef0f0;
            border: 1px solid #f56c6c;
            color: #333;
        }
        .info {
            background: #f4f4f5;
            border: 1px solid #909399;
            color: #333;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            margin-right: 10px;
        }
        .status-ok {
            background: #67c23a;
            color: white;
        }
        .status-error {
            background: #f56c6c;
            color: white;
        }
        .instructions {
            background: #e6f7ff;
            border-left: 4px solid #409eff;
            padding: 15px;
            margin-bottom: 20px;
        }
        .instructions h3 {
            margin-top: 0;
            color: #409eff;
        }
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .instructions li {
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Token è®¾ç½®å’Œ API æµ‹è¯•å·¥å…·</h1>
        
        <div class="instructions">
            <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
            <ol>
                <li>åœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­è¾“å…¥ä½ çš„ Bearer Token</li>
                <li>ç‚¹å‡»"è®¾ç½® Token åˆ° LocalStorage"æŒ‰é’®</li>
                <li>ç‚¹å‡»"æµ‹è¯• API"æŒ‰é’®éªŒè¯ token æ˜¯å¦æœ‰æ•ˆ</li>
                <li>å¦‚æœæµ‹è¯•æˆåŠŸï¼Œåˆ·æ–°ä½ çš„å‰ç«¯åº”ç”¨é¡µé¢</li>
            </ol>
        </div>
        
        <div class="section">
            <h2>1. Token è®¾ç½®</h2>
            <label>Bearer Token:</label>
            <textarea id="tokenInput" placeholder="è¾“å…¥ä½ çš„ Bearer tokenï¼ˆä¸éœ€è¦åŒ…å« 'Bearer ' å‰ç¼€ï¼‰">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc2NzUxOTg4MH0.XZkpt0TMHnVv1dAyLSyDPJS-BPaBKF7WuUDi3ehyVwg</textarea>
            
            <button onclick="setToken()">âœ… è®¾ç½® Token åˆ° LocalStorage</button>
            <button onclick="checkToken()" class="success">ğŸ” æ£€æŸ¥å½“å‰ Token</button>
            <button onclick="clearToken()" class="danger">ğŸ—‘ï¸ æ¸…é™¤ Token</button>
            
            <div id="tokenResult"></div>
        </div>
        
        <div class="section">
            <h2>2. API æµ‹è¯•</h2>
            <button onclick="testAPI()">ğŸš€ æµ‹è¯•å½’æ¡£é¡¹ç›® API</button>
            <button onclick="testWithFetch()">ğŸŒ ä½¿ç”¨ Fetch æµ‹è¯•</button>
            <button onclick="testWithAxios()">ğŸ“¡ ä½¿ç”¨ Axios æµ‹è¯•</button>
            
            <div id="apiResult"></div>
        </div>
        
        <div class="section">
            <h2>3. å½“å‰çŠ¶æ€</h2>
            <div id="statusInfo"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const API_BASE = 'http://localhost:8000/api';
        
        function getToken() {
            return localStorage.getItem('token');
        }
        
        function setToken() {
            const tokenInput = document.getElementById('tokenInput').value.trim();
            if (!tokenInput) {
                showResult('tokenResult', 'âŒ Token ä¸èƒ½ä¸ºç©º', 'error');
                return;
            }
            
            // ç§»é™¤å¯èƒ½å­˜åœ¨çš„ 'Bearer ' å‰ç¼€
            const token = tokenInput.replace(/^Bearer\s+/i, '');
            
            localStorage.setItem('token', token);
            showResult('tokenResult', `âœ… Token å·²è®¾ç½®åˆ° LocalStorage\nToken é•¿åº¦: ${token.length}\nToken é¢„è§ˆ: ${token.substring(0, 50)}...`, 'success');
            updateStatus();
        }
        
        function checkToken() {
            const token = getToken();
            if (token) {
                showResult('tokenResult', `âœ… Token å­˜åœ¨\nToken é•¿åº¦: ${token.length}\nToken é¢„è§ˆ: ${token.substring(0, 50)}...`, 'success');
            } else {
                showResult('tokenResult', 'âŒ LocalStorage ä¸­æœªæ‰¾åˆ° token', 'error');
            }
            updateStatus();
        }
        
        function clearToken() {
            localStorage.removeItem('token');
            showResult('tokenResult', 'âœ… Token å·²æ¸…é™¤', 'success');
            updateStatus();
        }
        
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${type}">${message}</div>`;
        }
        
        function updateStatus() {
            const token = getToken();
            const statusDiv = document.getElementById('statusInfo');
            statusDiv.innerHTML = `
                <div class="result info">
                    <strong>LocalStorage Token:</strong> ${token ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}<br>
                    ${token ? `Token é•¿åº¦: ${token.length}<br>Token é¢„è§ˆ: ${token.substring(0, 50)}...` : ''}
                </div>
            `;
        }
        
        async function testAPI() {
            const token = getToken();
            if (!token) {
                showResult('apiResult', 'âŒ è¯·å…ˆè®¾ç½® Token', 'error');
                return;
            }
            
            showResult('apiResult', 'â³ æ­£åœ¨æµ‹è¯• API...', 'info');
            
            try {
                const url = `${API_BASE}/archived-projects/?skip=0&limit=12`;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                const statusClass = response.ok ? 'status-ok' : 'status-error';
                
                if (response.ok) {
                    showResult('apiResult', `
                        <span class="status ${statusClass}">${response.status} OK</span>
                        âœ… API æµ‹è¯•æˆåŠŸï¼
                        
                        <strong>å“åº”æ•°æ®:</strong>
                        ${JSON.stringify(data, null, 2)}
                        
                        <strong>æ•°æ®æ¡æ•°:</strong> ${Array.isArray(data) ? data.length : 'N/A'}
                    `, 'success');
                } else {
                    showResult('apiResult', `
                        <span class="status ${statusClass}">${response.status} ${response.statusText}</span>
                        âŒ API æµ‹è¯•å¤±è´¥
                        
                        <strong>é”™è¯¯ä¿¡æ¯:</strong>
                        ${JSON.stringify(data, null, 2)}
                    `, 'error');
                }
            } catch (error) {
                showResult('apiResult', `
                    âŒ è¯·æ±‚å¤±è´¥
                    <strong>é”™è¯¯:</strong> ${error.message}
                `, 'error');
            }
        }
        
        async function testWithFetch() {
            const token = getToken();
            if (!token) {
                showResult('apiResult', 'âŒ è¯·å…ˆè®¾ç½® Token', 'error');
                return;
            }
            
            showResult('apiResult', 'â³ ä½¿ç”¨ Fetch API æµ‹è¯•...', 'info');
            
            try {
                const url = `${API_BASE}/archived-projects/?skip=0&limit=12`;
                console.log('Fetch URL:', url);
                console.log('Fetch Headers:', {
                    'Authorization': `Bearer ${token.substring(0, 30)}...`,
                    'Content-Type': 'application/json'
                });
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Fetch Response Status:', response.status);
                console.log('Fetch Response Headers:', Object.fromEntries(response.headers.entries()));
                
                const data = await response.json();
                console.log('Fetch Response Data:', data);
                
                const statusClass = response.ok ? 'status-ok' : 'status-error';
                showResult('apiResult', `
                    <span class="status ${statusClass}">${response.status} ${response.statusText}</span>
                    ${response.ok ? 'âœ…' : 'âŒ'} Fetch API æµ‹è¯•${response.ok ? 'æˆåŠŸ' : 'å¤±è´¥'}
                    
                    <strong>å“åº”æ•°æ®:</strong>
                    ${JSON.stringify(data, null, 2)}
                    
                    <strong>æ§åˆ¶å°æ—¥å¿—:</strong> è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å° (F12) è·å–è¯¦ç»†ä¿¡æ¯
                `, response.ok ? 'success' : 'error');
            } catch (error) {
                console.error('Fetch Error:', error);
                showResult('apiResult', `
                    âŒ Fetch è¯·æ±‚å¤±è´¥
                    <strong>é”™è¯¯:</strong> ${error.message}
                    <strong>æ§åˆ¶å°:</strong> è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯
                `, 'error');
            }
        }
        
        async function testWithAxios() {
            const token = getToken();
            if (!token) {
                showResult('apiResult', 'âŒ è¯·å…ˆè®¾ç½® Token', 'error');
                return;
            }
            
            showResult('apiResult', 'â³ ä½¿ç”¨ Axios æµ‹è¯•...', 'info');
            
            try {
                const url = `${API_BASE}/archived-projects/`;
                console.log('Axios URL:', url);
                console.log('Axios Config:', {
                    params: { skip: 0, limit: 12 },
                    headers: {
                        'Authorization': `Bearer ${token.substring(0, 30)}...`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const response = await axios.get(url, {
                    params: {
                        skip: 0,
                        limit: 12
                    },
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Axios Response:', response);
                
                showResult('apiResult', `
                    <span class="status status-ok">${response.status} OK</span>
                    âœ… Axios æµ‹è¯•æˆåŠŸï¼
                    
                    <strong>å“åº”æ•°æ®:</strong>
                    ${JSON.stringify(response.data, null, 2)}
                    
                    <strong>æ•°æ®æ¡æ•°:</strong> ${Array.isArray(response.data) ? response.data.length : 'N/A'}
                    
                    <strong>æ§åˆ¶å°æ—¥å¿—:</strong> è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å° (F12) è·å–è¯¦ç»†ä¿¡æ¯
                `, 'success');
            } catch (error) {
                console.error('Axios Error:', error);
                const status = error.response?.status;
                const statusClass = status ? (status === 200 ? 'status-ok' : 'status-error') : 'status-error';
                
                showResult('apiResult', `
                    <span class="status ${statusClass}">${status || 'Error'}</span>
                    âŒ Axios æµ‹è¯•å¤±è´¥
                    
                    <strong>é”™è¯¯ä¿¡æ¯:</strong>
                    ${error.response ? JSON.stringify(error.response.data, null, 2) : error.message}
                    
                    <strong>è¯·æ±‚é…ç½®:</strong>
                    ${error.config ? JSON.stringify({
                        url: error.config.url,
                        method: error.config.method,
                        headers: error.config.headers,
                        params: error.config.params
                    }, null, 2) : 'N/A'}
                    
                    <strong>æ§åˆ¶å°æ—¥å¿—:</strong> è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯
                `, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.onload = function() {
            updateStatus();
            checkToken();
        };
    </script>
</body>
</html>

